import math as ma
import numpy as np
import matplotlib.pyplot as plt
import matplotlib as mpl

plt.style.use('bmh')
# plt.style.use('dark_background')

mpl.rc('font',family='A-OTF Shin Go Pro')

samples = {
    
    '2': ('output_Scurve_prod_evts_5000_pdg_11_2_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '7': ('output_Scurve_prod_evts_5000_pdg_11_7_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '12': ('output_Scurve_prod_evts_5000_pdg_11_12_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '17': ('output_Scurve_prod_evts_5000_pdg_11_17_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '22': ('output_Scurve_prod_evts_5000_pdg_11_22_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '25': ('output_Scurve_prod_evts_1000_pdg_11_25_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '32': ('output_Scurve_prod_evts_5000_pdg_11_32_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '35': ('output_Scurve_prod_evts_1000_pdg_11_35_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '37': ('output_Scurve_prod_evts_5000_pdg_11_37_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '42': ('output_Scurve_prod_evts_1000_pdg_11_42_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '45': ('output_Scurve_prod_evts_1000_pdg_11_45_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '47': ('output_Scurve_prod_evts_1000_pdg_11_47_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '52': ('output_Scurve_prod_evts_1000_pdg_11_52_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '55': ('output_Scurve_prod_evts_1000_pdg_11_55_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '57': ('output_Scurve_prod_evts_1000_pdg_11_57_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '62': ('output_Scurve_prod_evts_1000_pdg_11_62_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '65': ('output_Scurve_prod_evts_1000_pdg_11_65_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '67': ('output_Scurve_prod_evts_1000_pdg_11_67_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '72': ('output_Scurve_prod_evts_1000_pdg_11_72_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '75': ('output_Scurve_prod_evts_1000_pdg_11_75_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '77': ('output_Scurve_prod_evts_1000_pdg_11_77_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '82': ('output_Scurve_prod_evts_1000_pdg_11_82_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '85': ('output_Scurve_prod_evts_1000_pdg_11_85_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '87': ('output_Scurve_prod_evts_1000_pdg_11_87_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '92': ('output_Scurve_prod_evts_1000_pdg_11_92_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '95': ('output_Scurve_prod_evts_1000_pdg_11_95_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '97': ('output_Scurve_prod_evts_1000_pdg_11_97_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 1000),
    '0.1': ('output_Scurve_prod_evts_5000_pdg_11_0.1_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000),
    '0.5': ('output_Scurve_prod_evts_5000_pdg_11_0.5_GeV_ThetaMinMax_40_140_PhiMinMax_-0.2_0.2.root', 5000)
}


resolutions = {'0.1': [ma.nan, 26.278767800230703, 26.389446163990378, 26.852413616916383, 27.427580408977718, 28.090631903821645, 28.69091441691823, 29.27683458541387, 29.87250229207599, 30.439485985551165, 30.971138155778632, 31.46292583000787, 31.909219982444288, 32.318020297302986, 32.70335573593929], '0.5': [ma.nan, ma.nan, 5.381181782326454, 5.6945179683659815, 6.145535240340024, 6.778370751249663, 7.439393097180891, 8.159279512594539, 8.812589801434774, 9.384541221626758, 9.897741762184225, 10.365210301197212, 10.819673978542847, 11.247786354875911, 11.64887219964185], '2': [ma.nan, ma.nan, 2.541843650878333, 2.1739002004969947, 1.849279048803608, 1.6865983874326944, 1.8456287454384632, 2.3300676370190354, 2.9597973717877095, 3.590862317781554, 4.210739202115384, 4.7640875492524035, 5.221606239239383, 5.640836303481388, 6.017226592405814], '7': [ma.nan, ma.nan, ma.nan, 2.351421532829284, 1.9181413892064496, 1.434919611573822, 1.0157784604755307, 0.817772751742542, 0.871998935088989, 1.1377743629112125, 1.5768490847304832, 2.0831631957756307, 2.5977022093396775, 3.084587917725005, 3.5172112173695034], '12': [ma.nan, ma.nan, ma.nan, 2.4189689892367627, 2.002055475352875, 1.5069093942224627, 0.9909775271298759, 0.629809140324996, 0.5390804308931193, 0.6427638236204429, 0.9135595637093886, 1.2919774908005455, 1.7287547897086193, 2.2148197866648807, 2.707719616993213], '17': [ma.nan, ma.nan, ma.nan, 2.4523013787218586, 2.066624613311811, 1.572430437360782, 1.0290293734105642, 0.6010286459844258, 0.4548522810318422, 0.49860299769523525, 0.6296132204571252, 0.8705119552177104, 1.244864394592237, 1.7040971947360395, 2.20798592086594], '22': [ma.nan, ma.nan, ma.nan, 2.4816735459823134, 2.0927266131724678, 1.610288063316024, 1.0656881515448509, 0.5961088782071018, 0.39483722417084094, 0.40751976532666007, 0.4969421023906526, 0.6814658587940735, 0.9632277510845328, 1.366345429371853, 1.8359486073757607], '25': [ma.nan, ma.nan, ma.nan, 2.512881844627042, 2.1303651297716653, 1.64453706823223, 1.0918532934949505, 0.6040296418566197, 0.3781520758014752, 0.3746019303673001, 0.4538667533648987, 0.6190994059234747, 0.8857310873721718, 1.2597237881217502, 1.6959055299874677], '32': [ma.nan, ma.nan, ma.nan, 2.5152101549874097, 2.1413923962694876, 1.6649341449576875, 1.1137736274071872, 0.6022299197354086, 0.34857355235716564, 0.33534955903670705, 0.38376343437057114, 0.4869260175946793, 0.6749455626727651, 0.9672459564418409, 1.3824627926630662], '35': [ma.nan, ma.nan, ma.nan, 2.5511904221633745, 2.171211150819226, 1.6874041040962202, 1.1263488555835597, 0.6080806329064098, 0.34332325886639203, 0.3192586155564548, 0.36491819494922806, 0.4589732140661527, 0.6456414967874672, 0.9420526612147976, 1.3448132174095684], '37': [ma.nan, ma.nan, ma.nan, 2.5332082949855694, 2.1578874579936684, 1.6846614810719982, 1.1380434803104131, 0.6180026748219141, 0.34888417914639547, 0.30770293071397986, 0.3576509822571022, 0.4504662747087362, 0.599293264982799, 0.8610175795410234, 1.2503622961910403], '42': [ma.nan, ma.nan, ma.nan, 2.566832402266655, 2.1843114587346957, 1.7028218350103332, 1.1501571261615264, 0.6214917523234996, 0.3269532360951708, 0.29221309990786776, 0.3351168350866194, 0.40115997119861924, 0.5303228531435825, 0.7722433493336778, 1.1290942518608431], '45': [ma.nan, ma.nan, ma.nan, 2.5646478232859824, 2.184755927456302, 1.7157907689610352, 1.158077849761745, 0.6191487550311933, 0.32069374557955843, 0.28003563040224694, 0.3103302621201476, 0.36584528980658415, 0.47770677775052695, 0.6790853851776704, 0.9983273295322231], '47': [ma.nan, ma.nan, ma.nan, 2.5671998138441103, 2.2014947739165036, 1.7154693472047085, 1.1638781134375102, 0.6307258875712356, 0.321469389253371, 0.2772569405292172, 0.30912975694917344, 0.36379219190947726, 0.4606885344207102, 0.6387246524890358, 0.9438062355623646], '52': [ma.nan, ma.nan, ma.nan, 2.5705643640037215, 2.2029114317590666, 1.7353226858577777, 1.1843695326401324, 0.6392720448439398, 0.3091272998764671, 0.2593774734389288, 0.28949574735899747, 0.338452225659282, 0.4412019449464516, 0.6219991709742632, 0.9064824764840812], '55': [ma.nan, ma.nan, ma.nan, ma.nan, 2.2136712275520205, 1.7355590341812366, 1.1874749827942641, 0.6463017807326377, 0.3155585287183782, 0.2613282555788028, 0.28480113714611965, 0.32645112246884056, 0.40285674527807763, 0.5378132587251355, 0.8052077832787332], '57': [ma.nan, ma.nan, ma.nan, 2.581290664060677, 2.2119711999734326, 1.7466148983447447, 1.1855055756986927, 0.6378189553854915, 0.30959593914551203, 0.2570676076653342, 0.2861820227522201, 0.32676359308528147, 0.41864389229473864, 0.55931830736181, 0.8035617833293365], '62': [ma.nan, ma.nan, ma.nan, 2.5799831488432545, 2.2191122163718786, 1.7524304784770497, 1.1978582422706492, 0.6475739662969049, 0.3156431571933158, 0.25735039308347535, 0.28856238167563025, 0.3298797789933297, 0.4190650592448604, 0.5520181142876308, 0.7872211320974541], '65': [ma.nan, ma.nan, ma.nan, 2.590918346438997, 2.2226560555312527, 1.749048093421078, 1.2026424587506128, 0.6500998696159541, 0.30208998695575784, 0.23952863638968294, 0.27153404298029604, 0.3093280109844532, 0.37239966183465306, 0.4877967041215589, 0.7031617162631622], '67': [ma.nan, ma.nan, ma.nan, 2.6021927405605854, 2.216720240893038, 1.7496852765483637, 1.1996832731226972, 0.6512241056702074, 0.31040730987044135, 0.25176394117515977, 0.279170275804268, 0.3119365086897052, 0.3716366755110211, 0.4910877995491934, 0.7058881437587764], '72': [ma.nan, ma.nan, ma.nan, 2.5916041033623456, 2.222936230796625, 1.7692601575515159, 1.215539832709665, 0.6602537801286241, 0.3047472097762368, 0.24055140218111154, 0.26485402024219645, 0.29902854456855493, 0.3474714479495505, 0.4454157560305618, 0.6239678424795947], '75': [ma.nan, ma.nan, ma.nan, ma.nan, 2.2234664047701864, 1.7590687833269, 1.2139877894041349, 0.6575895785808277, 0.29721380393773733, 0.22909078271910724, 0.25347118701218535, 0.28346381958126005, 0.3292140645038483, 0.4259002931404772, 0.6112351375215377], '77': [ma.nan, ma.nan, ma.nan, 2.5994247816859217, 2.2282572565148477, 1.764699343655623, 1.2144781876138964, 0.6591122282812684, 0.3053513227000876, 0.23900583463891328, 0.26743028304415906, 0.29520925295329153, 0.33577547498420807, 0.42693990674428717, 0.6197348951248725], '82': [ma.nan, ma.nan, ma.nan, 2.613153880539284, 2.252024349767937, 1.7830732378247056, 1.2267071962957117, 0.6633590912578736, 0.3070665851971643, 0.23398981648418218, 0.25619972215706266, 0.28562505309339636, 0.33356430712189816, 0.4124818453371264, 0.5635318219097694], '85': [ma.nan, ma.nan, ma.nan, 2.5966148716883737, 2.2331832485785585, 1.776167082530466, 1.223838048754603, 0.6674577528565786, 0.3009969523927369, 0.22682357942692177, 0.25712244026190084, 0.2867770616701865, 0.3274139990437048, 0.4082103877828426, 0.5629676976501115], '87': [ma.nan, ma.nan, ma.nan, 2.597201364836358, 2.247903349819299, 1.7749372219381396, 1.2208156546888824, 0.6564337396485426, 0.2992125642785485, 0.2274862296532433, 0.2608338278644308, 0.29467398744109785, 0.3324850033015408, 0.41456576314002597, 0.5732738876396719], '92': [ma.nan, ma.nan, ma.nan, 2.594771281039977, 2.253109496318938, 1.7957331783552979, 1.2455868414167433, 0.6872933655566525, 0.3091123804931043, 0.22114036819415345, 0.24499451615861503, 0.2631853923218006, 0.29566444103357564, 0.3692238087290733, 0.5180572318804824], '95': [ma.nan, ma.nan, ma.nan, 2.5970778024762087, 2.2551168482581665, 1.7851443657934376, 1.2346220538336297, 0.6721938556081863, 0.3000285082019045, 0.21702203381086757, 0.2390522182601289, 0.2589171472975351, 0.2880774386083322, 0.35585351141296767, 0.49322045793881386], '97': [ma.nan, ma.nan, ma.nan, 2.592415101894776, 2.2418662564180667, 1.7884548727804452, 1.2458792315242322, 0.6864772114298693, 0.30488907979119034, 0.21437278808135005, 0.24239227536432068, 0.264213285608065, 0.29524505076003216, 0.36842525697771406, 0.5004232718862319]}
w0_list= [2.,  2.5, 3.,  3.5, 4. , 4.5, 5.,  5.5, 6.,  6.5, 7.,  7.5, 8.,  8.5, 9. ]
nocorr_resolution={'0.1': 26.058838481439587, '0.5': 6.5845664380719855, '2': 2.307176823215707, '7': 1.3007719432557805, '12': 1.0904018627923575, '17': 1.0197179809587569, '22': 0.9771582005945176, '25': 0.9640664909611534, '32': 0.9440379536718829, '35': 0.9425358414464218, '37': 0.9415335089113654, '42': 0.9310944342974471, '45': 0.925664747210063, '47': 0.9225989959064803, '52': 0.9199061644117428, '55': 0.9106535344677686, '57': 0.9095883952343897, '62': 0.9197118128920425, '65': 0.912000527866502, '67': 0.9144661643067964, '72': 0.9182012989729668, '75': 0.9122217995852663, '77': 0.9132185825050175, '82': 0.8921947868774266, '85': 0.9076935111151406, '87': 0.9051692273239755, '92': 0.9020935979853162, '95': 0.9001249355645233, '97': 0.9115189409181366}
energies =[0.1, 0.5, 2.0, 7.0, 12.0, 17.0, 22.0, 25.0, 32.0, 35.0, 37.0, 42.0, 45.0, 47.0, 52.0, 55.0, 57.0, 62.0, 65.0, 67.0, 72.0, 75.0, 77.0, 82.0, 85.0, 87.0, 92.0, 95.0, 97.0]
# min_w0=[ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan, ma.nan]


# plt.figure(figsize=(15, 10))
# plt.grid()


Nsamples = len(samples)
Nplots = Nsamples//3 + Nsamples%3
Nline = Nplots//3 + 1 if Nplots%3 != 0 else 0

fig, axes = plt.subplots(Nline, 3, tight_layout=True, figsize=(18,16), sharey='row')
# fig.subplots_adjust(bottom=0.2)
fig.suptitle("theta resolution with weighting",
    fontsize=13,
    fontweight='bold',
    )

i_plot = 0
colors = ["#348ABD", "#A60628", "#7A68A6"]
# colors = ["#8dd3c7", "#feffb3", "#bfbbd9"]
for s in samples:
    plt.subplot(Nline,3,i_plot//3+1)
    plt.plot([],[],' ', label=f"{s} GeV") #hack to have a beautiful legend
    plt.plot(w0_list, resolutions[s], label=f"corr.", color=colors[i_plot%3]) # reminder that resolutions are multiplied by 1000 to ease readability on the axis
    plt.plot([w0_list[0],w0_list[-1]], [nocorr_resolution[s], nocorr_resolution[s]], '--', label='no corr.', alpha = 0.5, color=colors[i_plot%3])
    plt.subplots_adjust(bottom=0.4)
    if i_plot%3 == 2:
        plt.title(f"theta res. for "+ f"{energies[i_plot-2]}, {energies[i_plot-1]}, {energies[i_plot]} GeV", style='italic', fontsize = 9, loc='left')
        plt.legend(ncol=3, fontsize=11, labelspacing=0.05, loc='upper right')
        plt.ylabel('theta resolution*1000')
        plt.xlabel('w0', loc='right')
    if i_plot == Nsamples-1:
        plt.title(f"theta res. for " + (f"{energies[i_plot-1]}, {energies[i_plot]} GeV" if i_plot%3 == 1 else f"{energies[i_plot]} GeV"), style='italic', fontsize = 9, loc='left')
        plt.legend(ncol=3-i_plot%3, fontsize=11, labelspacing=0.05)
        plt.ylabel('theta resolution*1000')
        plt.xlabel('w0', loc='right')
    i_plot+=1
    
plt.show()  
plt.savefig('plots/resolutions_w0.png')
plt.close()
